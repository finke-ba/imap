<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Boiler</title>
	<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
	<script>
		$(document).ready(function () {
			var url = window.location.origin;
			var boilerId = getUrlParameter('boilerId');

			$.ajax({
				url: url + "/imap/boiler/" + boilerId
			}).then(function (data) {
				var boilerName = data.boilerName;
				var boilerAddress = data.address;
				var townName = data.townName;
				var townId = data.townId;
				$('.breadcrumb li:nth-child(2) > a').text(townName);
				$('.breadcrumb li:nth-child(2) > a').attr('href', 'town.html?townId=' + townId);
				$('.breadcrumb li:nth-child(3)').text(boilerName);
				$('.panel-title').text("Показания котельной " + boilerName + " по адресу " + boilerAddress);
			});

			$.ajax({
				url: url + "/imap/boiler/" + boilerId + "/check"
			}).then(function (data) {
				var trHTML = '';
				$.each(data, function (i, item) {
					trHTML += getTr(item.paramStatusId) + "<td>" +
							item.paramName + '</td><td>' +
							item.paramValue + '</td><td>' +
							item.date + '</td><td>' +
							item.paramStatus + '</td></tr>';
				});
				$('#boiler_table').append(trHTML);
			});

		});

		function getTr(paramStatusId) {
			if (paramStatusId == 1) {
				return "<tr class='success'>";
			} else if (paramStatusId == 2) {
				return "<tr class='warning'>";
			} else if (paramStatusId == 3) {
				return "<tr class='danger'>";
			}
		}

		function getDateFromTimeStamp(timestamp) {
			var d = new Date(timestamp),
					yyyy = d.getFullYear(),
					mm = ('0' + (d.getMonth() + 1)).slice(-2),
					dd = ('0' + d.getDate()).slice(-2),
					hh = d.getHours(),
					min = ('0' + d.getMinutes()).slice(-2),
					sec = ("0" + d.getSeconds()).slice(-2),
					time;
			time = yyyy + '-' + mm + '-' + dd + ', ' + hh + ':' + min + ':' + sec + ' ';
			return time;
		}


		function getUrlParameter(sParam) {
			var sPageURL = window.location.search.substring(1);
			var sURLVariables = sPageURL.split('&');
			for (var i = 0; i < sURLVariables.length; i++) {
				var sParameterName = sURLVariables[i].split('=');
				if (sParameterName[0] == sParam) {
					return sParameterName[1];
				}
			}
		}

	</script>
</head>
<body>
<div class='container'>
	<div class='row vertical-offset-100'>
		<div class='col-md-10 col-md-offset-1'>
			<div class='panel panel-default'>
				<div class='panel-heading'>
					<h3 class='panel-title'>Показания котельной boilerName по адресу boilerAddress</h3>
				</div>

				<ul class='breadcrumb'>
					<li><a href='index.html'>Карта</a></li>
					<li><a>townId</a></li>
					<li class='active'>boilerName</li>
				</ul>

				<div class='panel-body'>

					<div class='table-responsive'>
						<table id="boiler_table" class='table table-hover'>
							<thead>
							<tr>
								<th>Название параметра</th>
								<th>Значение параметра</th>
								<th>Время</th>
								<th>Причина</th>
							</tr>
							</thead>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

</body>
</html>